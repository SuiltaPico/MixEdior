# MixEditor 架构设计

## 起因

观察到编辑器（复文本、低代码、DAW）编辑的本质都是一样的，因此想做一个适用于所有场景的编辑器核心予以复用。

## 目的

MixEditor 的目的是一个通用编辑器框架。但是我并不知道如何设计它。我希望从这个目的开始，自上而下地细化出完整的设计思路。

### 编辑器的本质
* 内容
编辑器的内容是个实体的集合。内容由实体构成，而实体由状态构成。
* 编辑
内容是静态的，对内容进行修改的行为就是编辑，而编辑即状态迁移 `S --Delta-> S*`。
  * 变更信息（`Delta`）
    `Delta` 描述了状态迁移的方法。而 `Delta` 经常会其逆元 `Inv(Delta)`，使得 `S --Delta-> S* --InvDelta-> S*`。
    * 历史回溯
      在编辑过程中，常有对现在内容不满而回溯的需求。如果 `Delta` 能产生其逆元，那么回溯即可实现。我们可以构筑个 timeline 来记录到达当前内容的每个 `Delta`，即可让用户进行历史回溯。
      * `Delta` 合并
3. 视图
  * 输出映射
    编辑器需要将内容映射入用户的心智，因此需要视图层将编辑器的内容进行映射。
  * 输入映射
    视图需要将用户的内容更改意图转换为“变更信息”，然后驱动编辑器对内容进行变更。
